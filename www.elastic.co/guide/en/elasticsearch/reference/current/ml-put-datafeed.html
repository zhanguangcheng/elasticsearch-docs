<html><!-- Mirrored from www.elastic.co/guide/en/elasticsearch/reference/current/ml-put-datafeed.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 01 Apr 2020 14:19:20 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->

    
<meta charset="UTF-8">
<title>Create datafeeds API </title>
<link rel="home" href="index.html" title="Elasticsearch Reference [7.6]">
<link rel="up" href="ml-apis.html" title="Machine learning anomaly detection APIs">
<link rel="prev" href="ml-put-calendar.html" title="Create calendar API">
<link rel="next" href="ml-put-filter.html" title="Create filter API">
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.6">
<meta name="DC.subject" content="Elasticsearch">
<meta name="DC.identifier" content="7.6">

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="../../../../../apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../../../../../apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../../../../../apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../../../../../apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../../../../../apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../../../../../apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="../../../../../apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../../../../../apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../../apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="../../../../../favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../../../../android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="../../../../../favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="../../../../../favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="../../../../../manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="../../../../../mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd">
    <meta name="yandex-verification" content="d8a47e95d0972434">
    <meta name="localized" content="true">
    <meta name="st:robots" content="follow,index">
    <meta property="og:image" content="../../../../../static/images/elastic-logo-200.png">
    <link rel="shortcut icon" href="../../../../../favicon.ico" type="image/x-icon">
    <link rel="icon" href="../../../../../favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="../../../../../favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="../../../../../favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="../../../../../favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="../../../../static/styles.css">
  </head>

  <body>
    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="./gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type="text/javascript">
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id="ZN_emkP0oSe9Qrn7kF"><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id="elastic-nav" style="display:none;"></div>
    <script src="../../../../../elastic-nav.js"></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="https://www.elastic.co/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [7.6]</a></span>
»
<span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
»
<span class="breadcrumb-link"><a href="ml-apis.html">Machine learning anomaly detection APIs</a></span>
»
<span class="breadcrumb-node">Create datafeeds API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="ml-put-calendar.html">« Create calendar API</a>
</span>
<span class="next">
<a href="ml-put-filter.html">Create filter API »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a class="dashAnchor" name="//dash_ref_1205/Section/Sections/1"></a><a class="dashAnchor" name="//dash_ref_1206/Section/Create%20datafeeds%20API/0"></a><a id="ml-put-datafeed"></a>Create datafeeds API<a class="xpack_tag" href="https://www.elastic.co/subscriptions"></a></h2>
</div></div></div>

<p>Instantiates a datafeed.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a class="dashAnchor" name="//dash_ref_1199/Section/Request/0"></a><a id="ml-put-datafeed-request"></a>Request</h3>
</div></div></div>
<p><code class="literal">PUT _ml/datafeeds/&lt;feed_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a class="dashAnchor" name="//dash_ref_1200/Section/Prerequisites/0"></a><a id="ml-put-datafeed-prereqs"></a>Prerequisites</h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must create an anomaly detection job before you create a datafeed.
</li>
<li class="listitem">
If Elasticsearch security features are enabled, you must have <code class="literal">manage_ml</code> or <code class="literal">manage</code>
cluster privileges to use this API. See
<a class="xref" href="security-privileges.html" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a class="dashAnchor" name="//dash_ref_1201/Section/Description/0"></a><a id="ml-put-datafeed-desc"></a>Description</h3>
</div></div></div>
<p><a href="https://www.elastic.co/guide/en/machine-learning/7.6/ml-dfeeds.html" class="ulink" target="_top">Datafeeds</a> retrieve data from Elasticsearch for analysis by
an anomaly detection job. You can associate only one datafeed to each anomaly detection job.</p>
<p>The datafeed contains a query that runs at a defined interval (<code class="literal">frequency</code>). If
you are concerned about delayed data, you can add a delay (<code class="literal">query_delay</code>) at
each interval. See <a href="https://www.elastic.co/guide/en/machine-learning/7.6/ml-delayed-data-detection.html" class="ulink" target="_top">Handling delayed data</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must use Kibana or this API to create a datafeed. Do not put a
datafeed directly to the <code class="literal">.ml-config</code> index using the Elasticsearch index API. If Elasticsearch
security features are enabled, do not give users <code class="literal">write</code> privileges on the
<code class="literal">.ml-config</code> index.
</li>
<li class="listitem">
When Elasticsearch security features are enabled, your datafeed remembers which roles
the user who created it had at the time of creation and runs the query using
those same roles.
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a class="dashAnchor" name="//dash_ref_1202/Section/Path%20parameters/0"></a><a id="ml-put-datafeed-path-parms"></a>Path parameters</h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;feed_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A numerical character string that uniquely identifies the
datafeed. This identifier can contain lowercase alphanumeric characters (a-z
and 0-9), hyphens, and underscores. It must start and end with alphanumeric
characters.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a class="dashAnchor" name="//dash_ref_1203/Section/Request%20body/0"></a><a id="ml-put-datafeed-request-body"></a>Request body</h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">aggregations</code>
</span>
</dt>
<dd>
(Optional, object)
If set, the datafeed performs aggregation searches. Support for aggregations is
limited and should be used only with low cardinality data. For more information,
see
<a href="https://www.elastic.co/guide/en/machine-learning/7.6/ml-configuring-aggregation.html" class="ulink" target="_top">Aggregating data for faster performance</a>.
</dd>
<dt>
<span class="term">
<code class="literal">chunking_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Datafeeds might be required to search over long time periods, for several months
or years. This search is split into time chunks in order to ensure the load
on Elasticsearch is managed. Chunking configuration controls how the size of these time
chunks are calculated and is an advanced configuration option.
A chunking configuration object has the following properties:
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">chunking_config</code>.<code class="literal">mode</code>
</span>
</dt>
<dd>
<p>
(string)
There are three available modes:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">auto</code>: The chunk size is dynamically calculated. This is the default and
recommended value.
</li>
<li class="listitem">
<code class="literal">manual</code>: Chunking is applied according to the specified <code class="literal">time_span</code>.
</li>
<li class="listitem">
<code class="literal">off</code>: No chunking is applied.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">chunking_config</code>.<code class="literal">time_span</code>
</span>
</dt>
<dd>
(<a class="xref" href="common-options.html#time-units" title="Time units">time units</a>)
The time span that each search will be querying. This setting is only applicable
when the mode is set to <code class="literal">manual</code>. For example: <code class="literal">3h</code>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">delayed_data_check_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies whether the datafeed checks for missing data and the size of the
window. For example: <code class="literal">{"enabled": true, "check_window": "1h"}</code>.
</p>
<p>The datafeed can optionally search over indices that have already been read in
an effort to determine whether any data has subsequently been added to the index.
If missing data is found, it is a good indication that the <code class="literal">query_delay</code> option
is set too low and the data is being indexed after the datafeed has passed that
moment in time. See
<a href="https://www.elastic.co/guide/en/machine-learning/7.6/ml-delayed-data-detection.html" class="ulink" target="_top">Working with delayed data</a>.</p>
<p>This check runs only on real-time datafeeds.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">delayed_data_check_config</code>.<code class="literal">enabled</code>
</span>
</dt>
<dd>
(boolean) Specifies whether the datafeed periodically checks for delayed data.
Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">delayed_data_check_config</code>.<code class="literal">check_window</code>
</span>
</dt>
<dd>
(<a class="xref" href="common-options.html#time-units" title="Time units">time units</a>) The window of time that is searched for late data.
This window of time ends with the latest finalized bucket. It defaults to
<code class="literal">null</code>, which causes an appropriate <code class="literal">check_window</code> to be calculated when the
real-time datafeed runs. In particular, the default <code class="literal">check_window</code> span
calculation is based on the maximum of <code class="literal">2h</code> or <code class="literal">8 * bucket_span</code>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">frequency</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="common-options.html#time-units" title="Time units">time units</a>)
The interval at which scheduled queries are made while the datafeed runs in real
time. The default value is either the bucket span for short bucket spans, or,
for longer bucket spans, a sensible fraction of the bucket span. For example:
<code class="literal">150s</code>. When <code class="literal">frequency</code> is shorter than the bucket span, interim results for
the last (partial) bucket are written then eventually overwritten by the full
bucket results. If the datafeed uses aggregations, this value must be divisible
by the interval of the date histogram aggregation.
</dd>
<dt>
<span class="term">
<code class="literal">indices</code>
</span>
</dt>
<dd>
<p>
(Required, array)
An array of index names. Wildcards are supported. For example:
<code class="literal">["it_ops_metrics", "server*"]</code>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If any indices are in remote clusters then <code class="literal">cluster.remote.connect</code> must
not be set to <code class="literal">false</code> on any machine learning nodes.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">max_empty_searches</code>
</span>
</dt>
<dd>
(Optional,integer)
If a real-time datafeed has never seen any data (including during any initial
training period) then it will automatically stop itself and close its associated
job after this many real-time searches that return no documents. In other words,
it will stop after <code class="literal">frequency</code> times <code class="literal">max_empty_searches</code> of real-time operation.
If not set then a datafeed with no end time that sees no data will remain started
until it is explicitly stopped. By default this setting is not set.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, object)
The Elasticsearch query domain-specific language (DSL). This value corresponds to the
query object in an Elasticsearch search POST body. All the options that are supported by
Elasticsearch can be used, as this object is passed verbatim to Elasticsearch. By default, this
property has the following value: <code class="literal">{"match_all": {"boost": 1}}</code>.
</dd>
<dt>
<span class="term">
<code class="literal">query_delay</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="common-options.html#time-units" title="Time units">time units</a>)
The number of seconds behind real time that data is queried. For example, if
data from 10:04 a.m. might not be searchable in Elasticsearch until 10:06 a.m., set this
property to 120 seconds. The default value is randomly selected between <code class="literal">60s</code>
and <code class="literal">120s</code>. This randomness improves the query performance when there are
multiple jobs running on the same node. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/7.6/ml-delayed-data-detection.html" class="ulink" target="_top">Handling delayed data</a>.
</dd>
<dt>
<span class="term">
<code class="literal">script_fields</code>
</span>
</dt>
<dd>
(Optional, object)
Specifies scripts that evaluate custom expressions and returns script fields to
the datafeed. The detector configuration objects in a job can contain functions
that use these script fields. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/7.6/ml-configuring-transform.html" class="ulink" target="_top">Transforming data with script fields</a>
and <a class="xref" href="search-request-body.html#request-body-search-script-fields" title="Script Fields">Script fields</a>.
</dd>
<dt>
<span class="term">
<code class="literal">scroll_size</code>
</span>
</dt>
<dd>
(Optional, unsigned integer)
The <code class="literal">size</code> parameter that is used in Elasticsearch searches. The default value is <code class="literal">1000</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a class="dashAnchor" name="//dash_ref_1204/Section/Examples/0"></a><a id="ml-put-datafeed-example"></a>Examples</h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/datafeeds/datafeed-total-requests
{
  "job_id": "total-requests",
  "indices": ["server-metrics"]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1742.console"></div>
<p>When the datafeed is created, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "datafeed_id": "datafeed-total-requests",
  "job_id": "total-requests",
  "query_delay": "83474ms",
  "indices": [
    "server-metrics"
  ],
  "query": {
    "match_all": {
      "boost": 1.0
    }
  },
  "scroll_size": 1000,
  "chunking_config": {
    "mode": "auto"
  }
}</pre>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="ml-put-calendar.html">« Create calendar API</a>
</span>
<span class="next">
<a href="ml-put-filter.html">Create filter API »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/cloud/elasticsearch-service/signup?baymax=default&amp;elektra=docs&amp;storm=top-video">Elasticsearch Service: Free Trial</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&amp;elektra=docs&amp;storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&amp;elektra=docs&amp;storm=top-video">ELK for Logs &amp; Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id="elastic-footer"></div>
<script src="../../../../../elastic-footer.js"></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"https://www.elastic.co/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="../../../../../static/js/swiftype_app_search.umd.min.js"></script>
<script src="../../../../static/jquery.js"></script>
<script type="text/javascript" src="../../../../static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  

<!-- Mirrored from www.elastic.co/guide/en/elasticsearch/reference/current/ml-put-datafeed.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 01 Apr 2020 14:19:20 GMT -->

<script type="text/javascript" src="https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF"></script><script type="text/javascript" src="https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF"></script></body></html>