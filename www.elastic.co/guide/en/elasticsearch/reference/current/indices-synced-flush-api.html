<html><!-- Mirrored from www.elastic.co/guide/en/elasticsearch/reference/current/indices-synced-flush-api.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 01 Apr 2020 14:19:20 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->

    
<meta charset="UTF-8">
<title>Synced flush API </title>
<link rel="home" href="index.html" title="Elasticsearch Reference [7.6]">
<link rel="up" href="indices.html" title="Index APIs">
<link rel="prev" href="indices-split-index.html" title="Split index API">
<link rel="next" href="indices-types-exists.html" title="Type exists API">
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.6">
<meta name="DC.subject" content="Elasticsearch">
<meta name="DC.identifier" content="7.6">

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="../../../../../apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../../../../../apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../../../../../apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../../../../../apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../../../../../apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../../../../../apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="../../../../../apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../../../../../apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../../apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="../../../../../favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../../../../android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="../../../../../favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="../../../../../favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="../../../../../manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="../../../../../mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd">
    <meta name="yandex-verification" content="d8a47e95d0972434">
    <meta name="localized" content="true">
    <meta name="st:robots" content="follow,index">
    <meta property="og:image" content="../../../../../static/images/elastic-logo-200.png">
    <link rel="shortcut icon" href="../../../../../favicon.ico" type="image/x-icon">
    <link rel="icon" href="../../../../../favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="../../../../../favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="../../../../../favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="../../../../../favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="../../../../static/styles.css">
  </head>

  <body>
    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="./gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type="text/javascript">
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id="ZN_emkP0oSe9Qrn7kF"><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id="elastic-nav" style="display:none;"></div>
    <script src="../../../../../elastic-nav.js"></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="https://www.elastic.co/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [7.6]</a></span>
»
<span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
»
<span class="breadcrumb-link"><a href="indices.html">Index APIs</a></span>
»
<span class="breadcrumb-node">Synced flush API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="indices-split-index.html">« Split index API</a>
</span>
<span class="next">
<a href="indices-types-exists.html">Type exists API »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a class="dashAnchor" name="//dash_ref_3399/Section/Sections/1"></a><a class="dashAnchor" name="//dash_ref_3400/Section/Synced%20flush%20API/0"></a><a id="indices-synced-flush-api"></a>Synced flush API</h2>
</div></div></div>

<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Deprecated in 7.6.</h3>
<p>Synced-flush is deprecated and will be removed in 8.0. Use <a class="xref" href="indices-flush.html" title="Flush API">flush</a> instead. A flush has the same effect as a synced flush on Elasticsearch 7.6 or later.</p>
</div>
</div>
<p>Performs a synced flush on one or more indices.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /twitter/_flush/synced</pre>
</div>
<div class="console_widget" data-snippet="snippets/1672.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a class="dashAnchor" name="//dash_ref_3387/Section/Request/0"></a><a id="synced-flush-api-request"></a>Request</h3>
</div></div></div>
<p><code class="literal">POST /&lt;index&gt;/flush/synced</code></p>
<p><code class="literal">GET /&lt;index&gt;/flush/synced</code></p>
<p><code class="literal">POST /flush/synced</code></p>
<p><code class="literal">GET /flush/synced</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a class="dashAnchor" name="//dash_ref_3388/Section/Description/0"></a><a id="synced-flush-api-desc"></a>Description</h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a class="dashAnchor" name="//dash_ref_3393/Section/Use%20the%20synced%20flush%20API/0"></a><a id="synced-flush-using-api"></a>Use the synced flush API</h4>
</div></div></div>
<p>Use the synced flush API to manually initiate a synced flush.
This can be useful for a planned cluster restart where
you can stop indexing but don’t want to wait for 5 minutes until all indices
are marked as inactive and automatically sync-flushed.</p>
<p>You can request a synced flush even if there is ongoing indexing activity, and
Elasticsearch will perform the synced flush on a "best-effort" basis: shards that do not
have any ongoing indexing activity will be successfully sync-flushed, and other
shards will fail to sync-flush. The successfully sync-flushed shards will have
faster recovery times as long as the <code class="literal">sync_id</code> marker is not removed by a
subsequent flush.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a class="dashAnchor" name="//dash_ref_3394/Section/Synced%20flush%20overview/0"></a><a id="synced-flush-overview"></a>Synced flush overview</h4>
</div></div></div>
<p>Elasticsearch keeps track of which shards have received indexing activity recently, and
considers shards that have not received any indexing operations for 5 minutes to
be inactive.</p>
<p>When a shard becomes inactive Elasticsearch performs a special kind of flush
known as a <span class="strong strong"><strong>synced flush</strong></span>. A synced flush performs a normal
<a class="xref" href="indices-flush.html" title="Flush API">flush</a> on each replica of the shard, and then adds a marker known
as the <code class="literal">sync_id</code> to each replica to indicate that these copies have identical
Lucene indices. Comparing the <code class="literal">sync_id</code> markers of the two copies is a very
efficient way to check whether they have identical contents.</p>
<p>When allocating shard replicas, Elasticsearch must ensure that each replica contains the
same data as the primary. If the shard copies have been synced-flushed and the
replica shares a <code class="literal">sync_id</code> with the primary then Elasticsearch knows that the two copies
have identical contents. This means there is no need to copy any segment files
from the primary to the replica, which saves a good deal of time during
recoveries and restarts.</p>
<p>This is particularly useful for clusters having lots of indices which are very
rarely updated, such as with time-based indices. Without the synced flush
marker, recovery of this kind of cluster would be much slower.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a class="dashAnchor" name="//dash_ref_3395/Section/Check%20for%20sync%5Fid%20markers/0"></a><a id="synced-flush-sync-id-markers"></a>Check for <code class="literal">sync_id</code> markers</h4>
</div></div></div>
<p>To check whether a shard has a <code class="literal">sync_id</code> marker or not, look for the <code class="literal">commit</code>
section of the shard stats returned by the <a class="xref" href="indices-stats.html" title="Index stats API">indices stats</a> API:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /twitter/_stats?filter_path=**.commit&amp;level=shards <a id="CO580-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="console_widget" data-snippet="snippets/1673.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tbody><tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO580-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">filter_path</code> is used to reduce the verbosity of the response, but is entirely optional</p>
</td>
</tr>
</tbody></table>
</div>
<p>The API returns the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "indices": {
      "twitter": {
         "shards": {
            "0": [
               {
                 "commit" : {
                   "id" : "3M3zkw2GHMo2Y4h4/KFKCg==",
                   "generation" : 3,
                   "user_data" : {
                     "translog_uuid" : "hnOG3xFcTDeoI_kvvvOdNA",
                     "history_uuid" : "XP7KDJGiS1a2fHYiFL5TXQ",
                     "local_checkpoint" : "-1",
                     "translog_generation" : "2",
                     "max_seq_no" : "-1",
                     "sync_id" : "AVvFY-071siAOuFGEO9P", <a id="CO581-1"></a><i class="conum" data-value="1"></i>
                     "max_unsafe_auto_id_timestamp" : "-1",
                     "min_retained_seq_no" : "0"
                   },
                   "num_docs" : 0
                 }
               }
            ]
         }
      }
   }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tbody><tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO581-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>the <code class="literal">sync id</code> marker</p>
</td>
</tr>
</tbody></table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">sync_id</code> marker is removed as soon as the shard is flushed again, and
Elasticsearch may trigger an automatic flush of a shard at any time if there are
unflushed operations in the shard’s translog. In practice this means that one
should consider any indexing operation on an index as having removed its
<code class="literal">sync_id</code> markers.</p>
</div>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a class="dashAnchor" name="//dash_ref_3389/Section/Path%20parameters/0"></a><a id="synced-flush-api-path-params"></a>Path parameters</h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;index&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Comma-separated list or wildcard expression of index names
used to limit the request.
</p>
<p>To sync-flush all indices,
omit this parameter
or use a value of <code class="literal">_all</code> or <code class="literal">*</code>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a class="dashAnchor" name="//dash_ref_3390/Section/Query%20parameters/0"></a><a id="synced-flush-api-query-params"></a>Query parameters</h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
<p>
(Optional, boolean) If <code class="literal">true</code>,
the request does <span class="strong strong"><strong>not</strong></span> return an error
if a wildcard expression
or <code class="literal">_all</code> value retrieves only missing or closed indices.
</p>
<p>This parameter also applies to <a class="xref" href="indices-aliases.html" title="Update index alias API">index aliases</a>
that point to a missing or closed index.</p>
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string) Controls what kind of indices that wildcard
expressions can expand to. Valid values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Expand to open and closed indices.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Expand only to open indices.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Expand only to closed indices.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard expressions are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, boolean) If <code class="literal">true</code>, missing or closed indices are not included in the
response. Defaults to <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a class="dashAnchor" name="//dash_ref_3391/Section/Response%20codes/0"></a><a id="synced-flush-api-response-codes"></a>Response codes</h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">200</code>
</span>
</dt>
<dd>
All shards successfully sync-flushed.
</dd>
<dt>
<span class="term">
<code class="literal">409</code>
</span>
</dt>
<dd>
A replica shard failed to sync-flush.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a class="dashAnchor" name="//dash_ref_3392/Section/Examples/0"></a><a id="synced-flush-api-example"></a>Examples</h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a class="dashAnchor" name="//dash_ref_3396/Section/Sync%2Dflush%20a%20specific%20index/0"></a><a id="synced-flush-api-specific-ex"></a>Sync-flush a specific index</h4>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /kimchy/_flush/synced</pre>
</div>
<div class="console_widget" data-snippet="snippets/1674.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a class="dashAnchor" name="//dash_ref_3397/Section/Synch%2Dflush%20several%20indices/0"></a><a id="synced-flush-api-multi-ex"></a>Synch-flush several indices</h4>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /kimchy,elasticsearch/_flush/synced</pre>
</div>
<div class="console_widget" data-snippet="snippets/1675.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a class="dashAnchor" name="//dash_ref_3398/Section/Sync%2Dflush%20all%20indices/0"></a><a id="synced-flush-api-all-ex"></a>Sync-flush all indices</h4>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_flush/synced</pre>
</div>
<div class="console_widget" data-snippet="snippets/1676.console"></div>
<p>The response contains details about how many shards were successfully
sync-flushed and information about any failure.</p>
<p>The following response indicates two shards
and one replica shard
successfully sync-flushed:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "_shards": {
      "total": 2,
      "successful": 2,
      "failed": 0
   },
   "twitter": {
      "total": 2,
      "successful": 2,
      "failed": 0
   }
}</pre>
</div>
<p>The following response indicates one shard group failed
due to pending operations:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "_shards": {
      "total": 4,
      "successful": 2,
      "failed": 2
   },
   "twitter": {
      "total": 4,
      "successful": 2,
      "failed": 2,
      "failures": [
         {
            "shard": 1,
            "reason": "[2] ongoing operations on primary"
         }
      ]
   }
}</pre>
</div>
<p>Sometimes the failures are specific to a shard replica. The copies that failed
will not be eligible for fast recovery but those that succeeded still will be.
This case is reported as follows:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "_shards": {
      "total": 4,
      "successful": 1,
      "failed": 1
   },
   "twitter": {
      "total": 4,
      "successful": 3,
      "failed": 1,
      "failures": [
         {
            "shard": 1,
            "reason": "unexpected error",
            "routing": {
               "state": "STARTED",
               "primary": false,
               "node": "SZNr2J_ORxKTLUCydGX4zA",
               "relocating_node": null,
               "shard": 1,
               "index": "twitter"
            }
         }
      ]
   }
}</pre>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="indices-split-index.html">« Split index API</a>
</span>
<span class="next">
<a href="indices-types-exists.html">Type exists API »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/cloud/elasticsearch-service/signup?baymax=default&amp;elektra=docs&amp;storm=top-video">Elasticsearch Service: Free Trial</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&amp;elektra=docs&amp;storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&amp;elektra=docs&amp;storm=top-video">ELK for Logs &amp; Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id="elastic-footer"></div>
<script src="../../../../../elastic-footer.js"></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"https://www.elastic.co/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="../../../../../static/js/swiftype_app_search.umd.min.js"></script>
<script src="../../../../static/jquery.js"></script>
<script type="text/javascript" src="../../../../static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  

<!-- Mirrored from www.elastic.co/guide/en/elasticsearch/reference/current/indices-synced-flush-api.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 01 Apr 2020 14:19:20 GMT -->

<script type="text/javascript" src="https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF"></script><script type="text/javascript" src="https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF"></script></body></html>